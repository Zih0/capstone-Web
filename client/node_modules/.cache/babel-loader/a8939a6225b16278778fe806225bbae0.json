{"ast":null,"code":"import _slicedToArray from\"/Users/ziho/testapp2/capstoneWeb/client/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{useState,useRef,useCallback,useEffect}from'react';import Webcam from'react-webcam';import{Progress,Button,Typography}from'antd';import axios from'axios';import{useSelector}from'react-redux';import Fade from'react-reveal/Fade';var Title=Typography.Title,Paragraph=Typography.Paragraph,Text=Typography.Text;var VideoUpload=function VideoUpload(props){var user=useSelector(function(state){return state.user;});var _useState=useState(true),_useState2=_slicedToArray(_useState,2),webcamExists=_useState2[0],setWebcamExists=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),percent=_useState4[0],setPercent=_useState4[1];var webcamRef=useRef(null);var mediaRecorderRef=useRef(null);var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),capturing=_useState6[0],setCapturing=_useState6[1];var _useState7=useState([]),_useState8=_slicedToArray(_useState7,2),recordedChunks=_useState8[0],setRecordedChunks=_useState8[1];var _useState9=useState(''),_useState10=_slicedToArray(_useState9,2),video=_useState10[0],setVideo=_useState10[1];var _useState11=useState(null),_useState12=_slicedToArray(_useState11,2),imgSrc=_useState12[0],setImgSrc=_useState12[1];useEffect(function(){setWebcamExists(true);},[]);var CloseWebcamHandler=function CloseWebcamHandler(){setWebcamExists(false);};var StartCaptureClickHandler=function StartCaptureClickHandler(){setWebcamExists(true);setCapturing(true);setRecordedChunks([]);setImgSrc(null);mediaRecorderRef.current=new MediaRecorder(webcamRef.current.stream,{mimeType:'video/webm'});mediaRecorderRef.current.addEventListener('dataavailable',handleDataAvailable);mediaRecorderRef.current.start();var percentage=percent;var timer=setInterval(function(){percentage=percentage+1;setPercent(percentage);if(percentage>=100){setCapturing(false);mediaRecorderRef.current.stop();setPercent(0);clearInterval(timer);}},100);};var handleDataAvailable=useCallback(function(_ref){var data=_ref.data;if(data.size>0){setRecordedChunks([data]);MakeBlob([data]);}},[setRecordedChunks]);var MakeBlob=function MakeBlob(file){var blob=new Blob(file,{type:\"video/webm\"});var url=URL.createObjectURL(blob);setImgSrc(url);};var SaveHandler=function SaveHandler(file){var blob=new Blob(file,{type:\"video/webm\"});var formData=new FormData();var config={header:{'content-type':'multipart/form-data'}};formData.append('studentid',user.userData.studentId);formData.append('file',blob);axios.post('/api/datas/uploadfile',formData,config).then(function(response){if(response.data.success){setVideo(response.data.filePath);props.saveVideoHandler(response.data.filePath);props.updateStartHandler();CloseWebcamHandler();}else{console.log(response);}});};return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(Title,{children:\"\\uC601\\uC0C1 \\uB4F1\\uB85D\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'center',alignItems:'center',border:'1px solid lightgray',borderStyle:'dashed',height:'300px',padding:'1rem 1rem'},children:[/*#__PURE__*/_jsx(Fade,{children:webcamExists&&/*#__PURE__*/_jsx(Webcam,{audio:false,ref:webcamRef,height:230,width:306,screenshotFormat:\"video/webm\"})}),imgSrc&&/*#__PURE__*/_jsx(Fade,{children:/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:'1rem'},children:/*#__PURE__*/_jsx(\"video\",{controls:true,height:\"230\",autoPlay:true,children:/*#__PURE__*/_jsx(\"source\",{src:imgSrc,type:\"video/webm\"})})})})]}),/*#__PURE__*/_jsx(\"br\",{}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex'},children:[capturing?/*#__PURE__*/_jsx(\"p\",{children:\" \\uB179\\uD654\\uC911 \\uD83D\\uDCF9 \"}):/*#__PURE__*/_jsx(Button,{onClick:StartCaptureClickHandler,children:\"\\uC601\\uC0C1 \\uB179\\uD654\"}),/*#__PURE__*/_jsx(\"div\",{style:{marginLeft:'1rem'},children:imgSrc&&/*#__PURE__*/_jsx(Button,{onClick:function onClick(){return SaveHandler(recordedChunks);},children:\"\\uC601\\uC0C1 \\uC800\\uC7A5\"})})]}),/*#__PURE__*/_jsx(\"br\",{}),!imgSrc&&/*#__PURE__*/_jsx(\"div\",{style:{width:'300px'},children:/*#__PURE__*/_jsx(Progress,{percent:percent,showInfo:false,strokeWidth:13})}),imgSrc&&/*#__PURE__*/_jsx(Fade,{children:/*#__PURE__*/_jsxs(Paragraph,{children:[\"\\uB2E4\\uC2DC \\uB179\\uD654\\uD558\\uACE0 \\uC2F6\\uC73C\\uBA74 \",/*#__PURE__*/_jsx(Text,{code:true,children:\"\\uC601\\uC0C1\\uB179\\uD654\"}),\"\\uB97C \\uB20C\\uB7EC\\uC8FC\\uC2DC\\uACE0, \\uD574\\uB2F9 \\uC601\\uC0C1\\uC73C\\uB85C \\uB4F1\\uB85D\\uD558\\uC2DC\\uB824\\uBA74 \",/*#__PURE__*/_jsx(Text,{code:true,children:\"\\uC601\\uC0C1\\uC800\\uC7A5\"}),\"\\uC744 \\uB20C\\uB7EC\\uC8FC\\uC138\\uC694.\"]})})]});};export default VideoUpload;","map":null,"metadata":{},"sourceType":"module"}